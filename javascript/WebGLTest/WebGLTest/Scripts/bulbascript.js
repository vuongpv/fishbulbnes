// bulbascript.js
(function(){function executeScript(){
Type.registerNamespace('NES.CPU.Machine.Carts');NES.CPU.Machine.Carts.NameTableMirroring=function(){};NES.CPU.Machine.Carts.NameTableMirroring.prototype = {oneScreen:0,vertical:1,horizontal:2,fourScreen:3}
NES.CPU.Machine.Carts.NameTableMirroring.registerEnum('NES.CPU.Machine.Carts.NameTableMirroring',false);NES.CPU.Machine.Carts.INESCart=function(){};NES.CPU.Machine.Carts.INESCart.registerInterface('NES.CPU.Machine.Carts.INESCart');NES.CPU.Machine.Carts.BaseCart=function(){this.$0=new Array(16);this.$1=new Array(2);this.$4=-1;this.$5=-1;this.$6=-1;this.$7=-1;this.$12=new Array(8192);this.mirroring=-1;this.ppuBankStarts=new Array(16);this.$1A=new Array(256*16);for(var $0=0;$0<16;++$0){this.ppuBankStarts[$0]=$0*1024;}}
NES.CPU.Machine.Carts.BaseCart.prototype={$2:null,$3:null,get_chrRom:function(){return this.$3;},set_chrRom:function(value){this.$3=value;return value;},$8:false,$9:false,$A:false,$B:0,$C:0,get_chrRomCount:function(){return this.$C;},get_prgRomCount:function(){return this.$B;},$D:0,$E:0,$F:0,$10:0,$11:0,$13:null,get_romHashFunction:function(){return this.$13;},set_romHashFunction:function(value){this.$13=value;return value;},$14:0,chrRamStart:0,loadiNESCart:function(header,prgRoms,chrRoms,prgRomData,chrRomData,chrRomOffset){this.$1[0]=header[6];this.$1[1]=header[7];this.$D=(this.$1[0]&240)>>>4;this.$D+=this.$1[1]&240;this.$14=chrRomOffset;for(var $0=0;$0<header.length;++$0){this.$0[$0]=header[$0];}this.$B=prgRoms;this.$C=chrRoms;this.$2=new Array(prgRomData.length);for(var $1=0;$1<prgRomData.length;++$1){this.$2[$1]=prgRomData[$1];}if(this.$C===0){chrRomData=new Array(32768);}this.$3=new Array(chrRomData.length+4096);this.chrRamStart=chrRomData.length;for(var $2=0;$2<chrRomData.length;++$2){this.$3[$2]=chrRomData[$2];}this.$B=this.$0[4];this.$C=this.$0[5];this.$1[0]=this.$0[6];this.$1[1]=this.$0[7];this.$A=(this.$1[0]&2)===2;this.$9=true;this.set_usesSRAM((this.$1[0]&2)===2);this.$1E(0,0);if((this.$1[0]&1)===1){this.$1E(0,1);}else{this.$1E(0,2);}if((this.$1[0]&8)===8){this.$1E(0,3);}this.initializeCart();},whizzler:null,get_whizzler:function(){return this.whizzler;},set_whizzler:function(value){this.whizzler=value;return value;},irqRaised:false,get_irqRaised:function(){return this.irqRaised;},set_irqRaised:function(value){this.irqRaised=value;return value;},updateScanlineCounter:function(){},getByte:function(clock,address){var $0=0;switch(address&57344){case 24576:return this.$12[address&8191];case 32768:$0=this.$E;break;case 40960:$0=this.$F;break;case 49152:$0=this.$10;break;case 57344:$0=this.$11;break;}if($0+(address&8191)>this.$2.length){throw new Error('THis is broken!');}return this.$2[$0+(address&8191)];},$15:function($p0,$p1,$p2,$p3){$p0=this.$16($p0);$p1=this.$16($p1);$p2=this.$16($p2);$p3=this.$16($p3);this.$4=$p0;this.$5=$p1;this.$6=$p2;this.$7=$p3;this.$E=$p0*8192;this.$F=$p1*8192;this.$10=$p2*8192;this.$11=$p3*8192;},$16:function($p0){if($p0>=this.$B*2){var $0=255;while(($p0&$0)>=this.$B*2){$0=$0>>1;}return ($p0&$0);}else{return $p0;}},$17:null,get_checkSum:function(){return this.$17;},get_CPU:function(){throw new Error('CPU Not Implemented');},set_CPU:function(value){throw new Error('CPU Not Implemented');return value;},get_SRAM:function(){return this.$12;},set_SRAM:function(value){if(value!=null&&value.length===this.$12.length){this.$12=value;}return value;},$18:null,get_cartName:function(){return this.$18;},set_cartName:function(value){this.$18=value;return value;},get_numberOfPrgRoms:function(){return this.$B;},get_numberOfChrRoms:function(){return this.$C;},get_mapperID:function(){return this.$D;},get_mirroring:function(){return this.mirroring;},$19:null,get_nmiHandler:function(){return this.$19;},set_nmiHandler:function(value){this.$19=value;return value;},get_irqAsserted:function(){return false;},set_irqAsserted:function(value){return value;},get_nextEventAt:function(){return -1;},handleEvent:function(Clock){},resetClock:function(Clock){},get_ppuBankStarts:function(){return this.ppuBankStarts;},set_ppuBankStarts:function(value){this.ppuBankStarts=value;return value;},get_bankStartCache:function(){return this.$1A;},$1B:0,get_currentBank:function(){return this.$1B;},bankSwitchesChanged:false,get_bankSwitchesChanged:function(){return this.bankSwitchesChanged;},set_bankSwitchesChanged:function(value){this.bankSwitchesChanged=value;return value;},getPPUByte:function(clock,address){var $0=address>>10;var $1=this.ppuBankStarts[$0]+(address&1023);return this.$3[$1];},actualChrRomOffset:function(address){var $0=address>>10;var $1=this.ppuBankStarts[$0]+(address&1023);return $1;},setPPUByte:function(clock,address,data){var $0=address>>10;var $1=this.ppuBankStarts[$0]+(address&1023);this.$3[$1]=data;},$1C:0,get_$1D:function(){return this.$1C;},set_$1D:function($p0){this.$1C=$p0;return $p0;},$1E:function($p0,$p1){this.mirroring=$p1;if($p0>-1){this.whizzler.drawTo($p0);}switch($p1){case 0:this.ppuBankStarts[8]=this.chrRamStart+0+this.$1C;this.ppuBankStarts[9]=this.chrRamStart+0+this.$1C;this.ppuBankStarts[10]=this.chrRamStart+0+this.$1C;this.ppuBankStarts[11]=this.chrRamStart+0+this.$1C;break;case 1:this.ppuBankStarts[8]=this.chrRamStart+0;this.ppuBankStarts[9]=this.chrRamStart+1024;this.ppuBankStarts[10]=this.chrRamStart+0;this.ppuBankStarts[11]=this.chrRamStart+1024;break;case 2:this.ppuBankStarts[8]=this.chrRamStart+0;this.ppuBankStarts[9]=this.chrRamStart+0;this.ppuBankStarts[10]=this.chrRamStart+1024;this.ppuBankStarts[11]=this.chrRamStart+1024;break;case 3:this.ppuBankStarts[8]=this.chrRamStart+0;this.ppuBankStarts[9]=this.chrRamStart+1024;this.ppuBankStarts[10]=this.chrRamStart+2048;this.ppuBankStarts[11]=this.chrRamStart+3072;break;}this.whizzler.updatePixelInfo();},$1F:false,get_usesSRAM:function(){return this.$1F;},set_usesSRAM:function(value){this.$1F=value;return value;},get_chrRamStart:function(){return this.chrRamStart;},get_ppuBankStarts:function(){return this.ppuBankStarts;},set_ppuBankStarts:function(value){throw new Error('CPU Not Implemented');return value;}}
Type.registerNamespace('NES.CPU.Machine.ROMLoader');NES.CPU.Machine.ROMLoader.ByteArrayHolder=function(){}
NES.CPU.Machine.ROMLoader.ByteArrayHolder.prototype={$0:0,get_position:function(){return this.$0;},set_position:function(value){this.$0=value;return value;},$1:null,get_data:function(){return this.$1;},set_data:function(value){this.$1=value;return value;},read:function(target,start,end){var $0=0;for(var $1=start;$1<start+end;++$1){if(this.$0>=this.$1.length){break;}target[$1]=this.$1[this.$0];this.$0++;$0++;}return $0;}}
NES.CPU.Machine.ROMLoader.iNESFileHandler=function(){}
NES.CPU.Machine.ROMLoader.iNESFileHandler.loadROM=function(ppu,zipStream){var $0=null;var $1=new Array(16);var $2=zipStream.read($1,0,16);var $3=($1[6]&240);$3=$3/16;$3+=$1[7];var $4=$1[4];var $5=$1[5];var $6=new Array($4*16384);var $7=new Array($5*16384);var $8=0;$2=zipStream.read($6,0,$6.length);$8=zipStream.get_position();$2=zipStream.read($7,0,$7.length);switch($3){case 0:case 2:case 3:case 7:$0=new NES.CPU.NESCart();break;case 1:break;case 4:break;}if($0!=null){$0.set_whizzler(ppu);ppu.set_chrRomHandler($0);$0.loadiNESCart($1,$4,$5,$6,$7,$8);}return $0;}
Type.registerNamespace('NES.CPU');NES.CPU.NESCart=function(){this.$20=new Array(2048);this.$21=new Array(8);NES.CPU.NESCart.initializeBase(this);}
NES.CPU.NESCart.prototype={initializeCart:function(){for(var $0=0;$0<8;++$0){this.$21[$0]=-1;}switch(this.$D){case 0:case 1:case 2:case 3:if(this.get_chrRomCount()>0){this.$22(0,0,0,1);}this.$15(0,1,this.get_prgRomCount()*2-2,this.get_prgRomCount()*2-1);break;case 7:this.$15(0,1,2,3);this.$1E(0,0);break;default:throw new Error('Mapper '+this.$D.toString()+' not implemented.');}},$22:function($p0,$p1,$p2,$p3){if($p1>=this.get_chrRomCount()){$p1=this.get_chrRomCount()-1;}var $0=$p2*8;var $1=$p1*8;for(var $2=0;$2<($p3*8);++$2){this.ppuBankStarts[$1+$2]=($0+$2)*1024;}},setByte:function(clock,address,val){if(address>=24576&&address<=32767){if(this.$9){this.$20[address&8191]=val;}return;}if(this.$D===7){var $0=0;$0=4*(val&15);this.$15($0,$0+1,$0+2,$0+3);if((val&16)===16){this.set_$1D(1024);}else{this.set_$1D(0);}this.$1E(clock,0);}if(this.$D===3&&address>=32768){this.$22(clock,0,val,1);}if(this.$D===2&&address>=32768){var $1=0;$1=(val*2);this.$15($1,$1+1,this.$6,this.$7);}}}
Type.registerNamespace('NES.CPU.Fastendo');NES.CPU.Fastendo.AddressingModes=function(){};NES.CPU.Fastendo.AddressingModes.prototype = {bullshit:0,implicit:1,accumulator:2,immediate:3,zeroPage:4,zeroPageX:5,zeroPageY:6,relative:7,absolute:8,absoluteX:9,absoluteY:10,indirect:11,indexedIndirect:12,indirectIndexed:13,indirectZeroPage:14,indirectAbsoluteX:15}
NES.CPU.Fastendo.AddressingModes.registerEnum('NES.CPU.Fastendo.AddressingModes',false);NES.CPU.Fastendo.CPUStatusBits=function(){};NES.CPU.Fastendo.CPUStatusBits.prototype = {carry:0,zeroResult:1,interruptDisable:2,decimalMode:3,breakCommand:4,expansion:5,overflow:6,negativeResult:7}
NES.CPU.Fastendo.CPUStatusBits.registerEnum('NES.CPU.Fastendo.CPUStatusBits',false);NES.CPU.Fastendo.CPUStatusMasks=function(){};NES.CPU.Fastendo.CPUStatusMasks.prototype = {carryMask:1,zeroResultMask:2,interruptDisableMask:4,decimalModeMask:8,breakCommandMask:16,expansionMask:32,overflowMask:64,negativeResultMask:128}
NES.CPU.Fastendo.CPUStatusMasks.registerEnum('NES.CPU.Fastendo.CPUStatusMasks',false);NES.CPU.Fastendo.IMemoryMappedIOElement=function(){};NES.CPU.Fastendo.IMemoryMappedIOElement.registerInterface('NES.CPU.Fastendo.IMemoryMappedIOElement');NES.CPU.Fastendo.IClockedMemoryMappedIOElement=function(){};NES.CPU.Fastendo.IClockedMemoryMappedIOElement.registerInterface('NES.CPU.Fastendo.IClockedMemoryMappedIOElement');NES.CPU.Fastendo.CPU2A03=function(){this.$F=~0;this.$11=new Array(256);this.$12=new Array(256);this.addressmode=new Array(256);this.$1C=new Array(8192);this.$26=new Array(256);this.$29=new Array(256);this.$20=ss.Delegate.create(this,this.$21);this.$22=ss.Delegate.create(this,this.$23);this.setupticks();}
NES.CPU.Fastendo.CPU2A03.prototype={$0:0,$1:0,$2:0,$3:0,$4:0,get_accumulator:function(){return this.$2;},set_accumulator:function(value){this.$2=value;return value;},get_indexRegisterY:function(){return this.$4;},set_indexRegisterY:function(value){this.$4=value;return value;},get_indexRegisterX:function(){return this.$3;},set_indexRegisterX:function(value){this.$3=value;return value;},$5:0,get_programCounter:function(){return this.$5;},set_programCounter:function(value){this.$5=value;return value;},$6:0,get_statusRegister:function(){return this.$6;},set_statusRegister:function(value){this.$6=value;return value;},get_addressCodePage:function(){var $0=this.get_addressBus()>>8;return $0;},get_addressLowByte:function(){return this.get_addressBus()&255;},$7:0,get_addressBus:function(){return this.$7;},set_addressBus:function(value){this.$7=value;return value;},$8:0,get_dataBus:function(){return this.$8;},set_dataBus:function(value){this.$8=value;return value;},$9:function($p0){switch($p0){case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 8;case 4:return 16;case 5:return 32;case 6:return 64;case 7:return 128;}return 0;},setFlag:function(Flag,value){this.$6=((value)?(this.$6|Flag):(this.$6&~Flag));this.$6|=32;},getFlag:function(Flag){var $0=Flag;return ((this.$6&$0)===$0);},interruptRequest:function(){if(this.getFlag(4)){return;}this.setFlag(4,true);var $0=this.$6&~16|32;this.pushStack(this.get_programCounter()/256);this.pushStack(this.get_programCounter());this.pushStack(this.get_statusRegister());this.set_programCounter(this.getByte(65534)+(this.getByte(65535)<<8));},$A:false,get_memoryLock:function(){return this.$A;},set_memoryLock:function(value){this.$A=value;return value;},nonMaskableInterrupt:function(){var $0=this.$6&~16|32;this.setFlag(4,true);this.pushStack(this.$5>>8);this.pushStack(this.$5&255);this.pushStack($0);var $1=this.getByte(65530);var $2=this.getByte(65531);var $3=$1|($2<<8);this.set_programCounter($3);},$B:false,get_reset:function(){return this.$B;},set_reset:function(value){this.$B=value;if(this.$B){this.resetCPU();}return value;},curinst_AddressingMode:0,curinst_Address:0,curinst_OpCode:0,curinst_Parameters0:0,curinst_Parameters1:0,curinst_ExtraTiming:0,curinst_Length:0,get_operationCounter:function(){return this.$1;},$C:0,get_clock:function(){return this.$C;},set_clock:function(value){this.$C=value;return value;},$D:false,$E:false,$10:false,get_runningHard:function(){return this.$10;},set_runningHard:function(value){this.$10=value;return value;},checkEvent:function(){if(this.$F===-1){this.findNextEvent();}},runFast:function(){while(this.$C<29780){this.step();}},step:function(){this.curinst_ExtraTiming=0;if(this.$F<=this.$C){this.$25();}if(this.$D){this.$D=false;this.$C+=7;this.nonMaskableInterrupt();}else if(this.$E){this.$E=false;this.$C+=7;this.interruptRequest();}this.curinst_Address=this.$5;this.curinst_OpCode=this.getByte(this.$5++);this.curinst_AddressingMode=this.addressmode[this.curinst_OpCode];switch(this.curinst_AddressingMode){case 8:case 9:case 10:case 11:this.curinst_Parameters0=this.getByte(this.$5++);this.curinst_Parameters1=this.getByte(this.$5++);break;case 4:case 5:case 6:case 7:case 12:case 13:case 14:case 3:this.curinst_Parameters0=this.getByte(this.$5++);break;case 2:case 1:break;default:break;}this.execute();this.$C+=NES.CPU.Fastendo.CPU2A03.$1B[this.curinst_OpCode]+this.curinst_ExtraTiming;},runCycles:function(count){var $0=this.$0;while(this.$0-$0<count){this.step();}},get_ticks:function(){return this.$0;},set_ticks:function(value){this.$0=value;return value;},setupticks:function(){this.$11[0]=7;this.addressmode[0]=1;this.$11[1]=6;this.addressmode[1]=12;this.$11[2]=2;this.addressmode[2]=1;this.$11[3]=2;this.addressmode[3]=0;this.$11[4]=3;this.addressmode[4]=0;this.$11[5]=3;this.addressmode[5]=4;this.$11[6]=5;this.addressmode[6]=4;this.$11[7]=2;this.addressmode[7]=0;this.$11[8]=3;this.addressmode[8]=1;this.$11[9]=3;this.addressmode[9]=3;this.$11[10]=2;this.addressmode[10]=2;this.$11[11]=2;this.addressmode[11]=1;this.$11[12]=4;this.addressmode[12]=8;this.$11[13]=4;this.addressmode[13]=8;this.$11[14]=6;this.addressmode[14]=8;this.$11[15]=2;this.addressmode[15]=1;this.$11[16]=2;this.addressmode[16]=7;this.$11[17]=5;this.addressmode[17]=13;this.$11[18]=3;this.addressmode[18]=14;this.$11[19]=2;this.addressmode[19]=1;this.$11[20]=3;this.addressmode[20]=4;this.$11[21]=4;this.addressmode[21]=5;this.$11[22]=6;this.addressmode[22]=5;this.$11[23]=2;this.addressmode[23]=1;this.$11[24]=2;this.addressmode[24]=1;this.$11[25]=4;this.addressmode[25]=10;this.$11[26]=2;this.addressmode[26]=1;this.$11[27]=2;this.addressmode[27]=1;this.$11[28]=4;this.addressmode[28]=8;this.$11[29]=4;this.addressmode[29]=9;this.$11[30]=7;this.addressmode[30]=9;this.$11[31]=2;this.addressmode[31]=1;this.$11[32]=6;this.addressmode[32]=8;this.$11[33]=6;this.addressmode[33]=12;this.$11[34]=2;this.addressmode[34]=1;this.$11[35]=2;this.addressmode[35]=1;this.$11[36]=3;this.addressmode[36]=4;this.$11[37]=3;this.addressmode[37]=4;this.$11[38]=5;this.addressmode[38]=4;this.$11[39]=2;this.addressmode[39]=1;this.$11[40]=4;this.addressmode[40]=1;this.$11[41]=3;this.addressmode[41]=3;this.$11[42]=2;this.addressmode[42]=2;this.$11[43]=2;this.addressmode[43]=1;this.$11[44]=4;this.addressmode[44]=8;this.$11[45]=4;this.addressmode[45]=8;this.$11[46]=6;this.addressmode[46]=8;this.$11[47]=2;this.addressmode[47]=1;this.$11[48]=2;this.addressmode[48]=7;this.$11[49]=5;this.addressmode[49]=13;this.$11[50]=3;this.addressmode[50]=14;this.$11[51]=2;this.addressmode[51]=1;this.$11[52]=4;this.addressmode[52]=5;this.$11[53]=4;this.addressmode[53]=5;this.$11[54]=6;this.addressmode[54]=5;this.$11[55]=2;this.addressmode[55]=1;this.$11[56]=2;this.addressmode[56]=1;this.$11[57]=4;this.addressmode[57]=10;this.$11[58]=2;this.addressmode[58]=1;this.$11[59]=2;this.addressmode[59]=1;this.$11[60]=4;this.addressmode[60]=9;this.$11[61]=4;this.addressmode[61]=9;this.$11[62]=7;this.addressmode[62]=9;this.$11[63]=2;this.addressmode[63]=1;this.$11[64]=6;this.addressmode[64]=1;this.$11[65]=6;this.addressmode[65]=12;this.$11[66]=2;this.addressmode[66]=1;this.$11[67]=2;this.addressmode[67]=1;this.$11[68]=2;this.addressmode[68]=1;this.$11[69]=3;this.addressmode[69]=4;this.$11[70]=5;this.addressmode[70]=4;this.$11[71]=2;this.addressmode[71]=1;this.$11[72]=3;this.addressmode[72]=1;this.$11[73]=3;this.addressmode[73]=3;this.$11[74]=2;this.addressmode[74]=2;this.$11[75]=2;this.addressmode[75]=1;this.$11[76]=3;this.addressmode[76]=8;this.$11[77]=4;this.addressmode[77]=8;this.$11[78]=6;this.addressmode[78]=8;this.$11[79]=2;this.addressmode[79]=1;this.$11[80]=2;this.addressmode[80]=7;this.$11[81]=5;this.addressmode[81]=13;this.$11[82]=3;this.addressmode[82]=14;this.$11[83]=2;this.addressmode[83]=1;this.$11[84]=2;this.addressmode[84]=1;this.$11[85]=4;this.addressmode[85]=5;this.$11[86]=6;this.addressmode[86]=5;this.$11[87]=2;this.addressmode[87]=1;this.$11[88]=2;this.addressmode[88]=1;this.$11[89]=4;this.addressmode[89]=10;this.$11[90]=3;this.addressmode[90]=1;this.$11[91]=2;this.addressmode[91]=1;this.$11[92]=2;this.addressmode[92]=1;this.$11[93]=4;this.addressmode[93]=9;this.$11[94]=7;this.addressmode[94]=9;this.$11[95]=2;this.addressmode[95]=1;this.$11[96]=6;this.addressmode[96]=1;this.$11[97]=6;this.addressmode[97]=12;this.$11[98]=2;this.addressmode[98]=1;this.$11[99]=2;this.addressmode[99]=1;this.$11[100]=3;this.addressmode[100]=4;this.$11[101]=3;this.addressmode[101]=4;this.$11[102]=5;this.addressmode[102]=4;this.$11[103]=2;this.addressmode[103]=1;this.$11[104]=4;this.addressmode[104]=1;this.$11[105]=3;this.addressmode[105]=3;this.$11[106]=2;this.addressmode[106]=2;this.$11[107]=2;this.addressmode[107]=1;this.$11[108]=5;this.addressmode[108]=11;this.$11[109]=4;this.addressmode[109]=8;this.$11[110]=6;this.addressmode[110]=8;this.$11[111]=2;this.addressmode[111]=1;this.$11[112]=2;this.addressmode[112]=7;this.$11[113]=5;this.addressmode[113]=13;this.$11[114]=3;this.addressmode[114]=14;this.$11[115]=2;this.addressmode[115]=1;this.$11[116]=4;this.addressmode[116]=5;this.$11[117]=4;this.addressmode[117]=5;this.$11[118]=6;this.addressmode[118]=5;this.$11[119]=2;this.addressmode[119]=1;this.$11[120]=2;this.addressmode[120]=1;this.$11[121]=4;this.addressmode[121]=10;this.$11[122]=4;this.addressmode[122]=1;this.$11[123]=2;this.addressmode[123]=1;this.$11[124]=6;this.addressmode[124]=15;this.$11[125]=4;this.addressmode[125]=9;this.$11[126]=7;this.addressmode[126]=9;this.$11[127]=2;this.addressmode[127]=1;this.$11[128]=2;this.addressmode[128]=7;this.$11[129]=6;this.addressmode[129]=12;this.$11[130]=2;this.addressmode[130]=1;this.$11[131]=2;this.addressmode[131]=1;this.$11[132]=2;this.addressmode[132]=4;this.$11[133]=2;this.addressmode[133]=4;this.$11[134]=2;this.addressmode[134]=4;this.$11[135]=2;this.addressmode[135]=1;this.$11[136]=2;this.addressmode[136]=1;this.$11[137]=2;this.addressmode[137]=3;this.$11[138]=2;this.addressmode[138]=1;this.$11[139]=2;this.addressmode[139]=1;this.$11[140]=4;this.addressmode[140]=8;this.$11[141]=4;this.addressmode[141]=8;this.$11[142]=4;this.addressmode[142]=8;this.$11[143]=2;this.addressmode[143]=1;this.$11[144]=2;this.addressmode[144]=7;this.$11[145]=6;this.addressmode[145]=13;this.$11[146]=3;this.addressmode[146]=14;this.$11[147]=2;this.addressmode[147]=1;this.$11[148]=4;this.addressmode[148]=5;this.$11[149]=4;this.addressmode[149]=5;this.$11[150]=4;this.addressmode[150]=6;this.$11[151]=2;this.addressmode[151]=1;this.$11[152]=2;this.addressmode[152]=1;this.$11[153]=5;this.addressmode[153]=10;this.$11[154]=2;this.addressmode[154]=1;this.$11[155]=2;this.addressmode[155]=1;this.$11[156]=4;this.addressmode[156]=8;this.$11[157]=5;this.addressmode[157]=9;this.$11[158]=5;this.addressmode[158]=9;this.$11[159]=2;this.addressmode[159]=1;this.$11[160]=3;this.addressmode[160]=3;this.$11[161]=6;this.addressmode[161]=12;this.$11[162]=3;this.addressmode[162]=3;this.$11[163]=2;this.addressmode[163]=1;this.$11[164]=3;this.addressmode[164]=4;this.$11[165]=3;this.addressmode[165]=4;this.$11[166]=3;this.addressmode[166]=4;this.$11[167]=2;this.addressmode[167]=1;this.$11[168]=2;this.addressmode[168]=1;this.$11[169]=3;this.addressmode[169]=3;this.$11[170]=2;this.addressmode[170]=1;this.$11[171]=2;this.addressmode[171]=1;this.$11[172]=4;this.addressmode[172]=8;this.$11[173]=4;this.addressmode[173]=8;this.$11[174]=4;this.addressmode[174]=8;this.$11[175]=2;this.addressmode[175]=1;this.$11[176]=2;this.addressmode[176]=7;this.$11[177]=5;this.addressmode[177]=13;this.$11[178]=3;this.addressmode[178]=14;this.$11[179]=2;this.addressmode[179]=1;this.$11[180]=4;this.addressmode[180]=5;this.$11[181]=4;this.addressmode[181]=5;this.$11[182]=4;this.addressmode[182]=6;this.$11[183]=2;this.addressmode[183]=1;this.$11[184]=2;this.addressmode[184]=1;this.$11[185]=4;this.addressmode[185]=10;this.$11[186]=2;this.addressmode[186]=1;this.$11[187]=2;this.addressmode[187]=1;this.$11[188]=4;this.addressmode[188]=9;this.$11[189]=4;this.addressmode[189]=9;this.$11[190]=4;this.addressmode[190]=10;this.$11[191]=2;this.addressmode[191]=1;this.$11[192]=3;this.addressmode[192]=3;this.$11[193]=6;this.addressmode[193]=12;this.$11[194]=2;this.addressmode[194]=1;this.$11[195]=2;this.addressmode[195]=1;this.$11[196]=3;this.addressmode[196]=4;this.$11[197]=3;this.addressmode[197]=4;this.$11[198]=5;this.addressmode[198]=4;this.$11[199]=2;this.addressmode[199]=1;this.$11[200]=2;this.addressmode[200]=1;this.$11[201]=3;this.addressmode[201]=3;this.$11[202]=2;this.addressmode[202]=1;this.$11[203]=2;this.addressmode[203]=1;this.$11[204]=4;this.addressmode[204]=8;this.$11[205]=4;this.addressmode[205]=8;this.$11[206]=6;this.addressmode[206]=8;this.$11[207]=2;this.addressmode[207]=1;this.$11[208]=2;this.addressmode[208]=7;this.$11[209]=5;this.addressmode[209]=13;this.$11[210]=3;this.addressmode[210]=14;this.$11[211]=2;this.addressmode[211]=1;this.$11[212]=2;this.addressmode[212]=1;this.$11[213]=4;this.addressmode[213]=5;this.$11[214]=6;this.addressmode[214]=5;this.$11[215]=2;this.addressmode[215]=1;this.$11[216]=2;this.addressmode[216]=1;this.$11[217]=4;this.addressmode[217]=10;this.$11[218]=3;this.addressmode[218]=1;this.$11[219]=2;this.addressmode[219]=1;this.$11[220]=2;this.addressmode[220]=1;this.$11[221]=4;this.addressmode[221]=9;this.$11[222]=7;this.addressmode[222]=9;this.$11[223]=2;this.addressmode[223]=1;this.$11[224]=3;this.addressmode[224]=3;this.$11[225]=6;this.addressmode[225]=12;this.$11[226]=2;this.addressmode[226]=1;this.$11[227]=2;this.addressmode[227]=1;this.$11[228]=3;this.addressmode[228]=4;this.$11[229]=3;this.addressmode[229]=4;this.$11[230]=5;this.addressmode[230]=4;this.$11[231]=2;this.addressmode[231]=1;this.$11[232]=2;this.addressmode[232]=1;this.$11[233]=3;this.addressmode[233]=3;this.$11[234]=2;this.addressmode[234]=1;this.$11[235]=2;this.addressmode[235]=1;this.$11[236]=4;this.addressmode[236]=8;this.$11[237]=4;this.addressmode[237]=8;this.$11[238]=6;this.addressmode[238]=8;this.$11[239]=2;this.addressmode[239]=1;this.$11[240]=2;this.addressmode[240]=7;this.$11[241]=5;this.addressmode[241]=13;this.$11[242]=3;this.addressmode[242]=14;this.$11[243]=2;this.addressmode[243]=1;this.$11[244]=2;this.addressmode[244]=1;this.$11[245]=4;this.addressmode[245]=5;this.$11[246]=6;this.addressmode[246]=5;this.$11[247]=2;this.addressmode[247]=1;this.$11[248]=2;this.addressmode[248]=1;this.$11[249]=4;this.addressmode[249]=10;this.$11[250]=4;this.addressmode[250]=1;this.$11[251]=2;this.addressmode[251]=1;this.$11[252]=2;this.addressmode[252]=1;this.$11[253]=4;this.addressmode[253]=9;this.$11[254]=7;this.addressmode[254]=9;this.$11[255]=2;this.addressmode[255]=1;},resetCPU:function(){this.$6=52;this.$1=0;this.$24=253;this.setupticks();this.set_ticks(0);this.set_programCounter(this.getByte(65532)+this.getByte(65533)*256);},powerOn:function(){this.$6=52;this.$24=253;this.$1=0;this.setupticks();this.set_ticks(0);for(var $0=0;$0<2048;++$0){this.$1C[$0]=255;}this.$1C[8]=247;this.$1C[9]=239;this.$1C[10]=223;this.$1C[15]=191;this.set_programCounter(this.getByte(65532)+this.getByte(65533)*256);},$13:0,$14:0,$15:function(){this.curinst_ExtraTiming=0;var $0=0;switch(this.curinst_AddressingMode){case 8:$0=((this.curinst_Parameters1<<8)|this.curinst_Parameters0);break;case 9:$0=(((this.curinst_Parameters1<<8)|this.curinst_Parameters0)+this.$3);if(($0&255)<this.$3){this.curinst_ExtraTiming=1;}break;case 10:$0=(((this.curinst_Parameters1<<8)|this.curinst_Parameters0)+this.$4);if(($0&255)<this.$4){this.curinst_ExtraTiming=1;}break;case 4:$0=this.curinst_Parameters0&255;break;case 5:$0=(this.curinst_Parameters0+this.$3)&255;break;case 6:$0=(this.curinst_Parameters0+this.$4)&255;break;case 11:this.$13=this.curinst_Parameters0;this.$14=this.curinst_Parameters1<<8;var $1=(this.$14|this.$13)&65535;var $2=this.getByte($1);this.$13=(this.$13+1)&255;$1=(this.$14|this.$13)&65535;$2|=(this.getByte($1)<<8);$0=$2;break;case 12:var $3=(this.curinst_Parameters0+this.$3)&255;this.$13=this.getByte($3);$3=$3+1;this.$14=this.getByte($3&255);this.$14=this.$14<<8;$0=this.$14|this.$13;break;case 13:this.$13=this.getByte(this.curinst_Parameters0);this.$14=this.getByte((this.curinst_Parameters0+1)&255)<<8;$3=(this.$13|this.$14);$0=$3+this.$4;if(($0&255)>this.$4){this.curinst_ExtraTiming=1;}break;case 7:$0=(this.$5+this.curinst_Parameters0);break;default:throw new Error('Executors.DecodeAddress() recieved an invalid addressmode');}return $0;},$16:function(){switch(this.curinst_AddressingMode){case 3:this.set_dataBus(this.curinst_Parameters0);return this.curinst_Parameters0;case 2:return this.$2;default:this.set_dataBus(this.getByte(this.$15()));return this.get_dataBus();}},$17:function($p0){},execute:function(){switch(this.curinst_OpCode){case 105:case 101:case 117:case 109:case 125:case 121:case 97:case 113:this.ADC();break;case 41:case 37:case 53:case 45:case 61:case 57:case 33:case 49:this.AND();break;case 10:case 6:case 22:case 14:case 30:this.ASL();break;case 144:this.BCC();break;case 176:this.BCS();break;case 240:this.BEQ();break;case 36:case 44:this.BIT();break;case 48:this.BMI();break;case 208:this.BNE();break;case 16:this.BPL();break;case 0:this.BRK();break;case 80:this.BVC();break;case 112:this.BVS();break;case 24:this.CLC();break;case 216:this.CLD();break;case 88:this.CLI();break;case 184:this.CLV();break;case 201:case 197:case 213:case 205:case 221:case 217:case 193:case 209:this.CMP();break;case 224:case 228:case 236:this.CPX();break;case 192:case 196:case 204:this.CPY();break;case 198:case 214:case 206:case 222:this.DEC();break;case 202:this.DEX();break;case 136:this.DEY();break;case 73:case 69:case 85:case 77:case 93:case 89:case 65:case 81:this.EOR();break;case 230:case 246:case 238:case 254:this.INC();break;case 232:this.INX();break;case 200:this.INY();break;case 76:case 108:this.JMP();break;case 32:this.JSR();break;case 169:case 165:case 181:case 173:case 189:case 185:case 161:case 177:this.LDA();break;case 162:case 166:case 182:case 174:case 190:this.LDX();break;case 160:case 164:case 180:case 172:case 188:this.LDY();break;case 74:case 70:case 86:case 78:case 94:this.LSR();break;case 234:case 26:case 58:case 90:case 122:case 218:case 250:case 4:case 20:case 52:case 68:case 100:case 128:case 130:case 137:case 194:case 212:case 226:case 244:case 12:case 28:case 60:case 92:case 124:case 220:case 252:this.NOP();break;case 9:case 5:case 21:case 13:case 29:case 25:case 1:case 17:this.ORA();break;case 72:this.PHA();break;case 8:this.PHP();break;case 104:this.PLA();break;case 40:this.PLP();break;case 42:case 38:case 54:case 46:case 62:this.ROL();break;case 106:case 102:case 118:case 110:case 126:this.ROR();break;case 64:this.RTI();break;case 96:this.RTS();break;case 233:case 229:case 245:case 237:case 253:case 249:case 225:case 241:this.SBC();break;case 56:this.SEC();break;case 248:this.SED();break;case 120:this.SEI();break;case 133:case 149:case 141:case 157:case 153:case 129:case 145:this.STA();break;case 134:case 150:case 142:this.STX();break;case 132:case 148:case 140:this.STY();break;case 170:this.TAX();break;case 168:this.TAY();break;case 186:this.TSX();break;case 138:this.TXA();break;case 154:this.TXS();break;case 152:this.TYA();break;}},$18:function($p0){if(($p0&255)===0){this.$6|=2;}else{this.$6&=~(2);}if(($p0&128)===128){this.$6|=128;}else{this.$6&=~(128);}},LDA:function(){this.$2=this.$16();this.$18(this.$2);},LDX:function(){this.$3=this.$16();this.$18(this.$3);},LDY:function(){this.$4=this.$16();this.$18(this.$4);},STA:function(){this.setByte(this.$15(),this.$2);},STX:function(){this.setByte(this.$15(),this.$3);},STY:function(){this.setByte(this.$15(),this.$4);},SED:function(){this.setFlag(8,true);},CLD:function(){this.setFlag(8,false);},JMP:function(){if(this.curinst_AddressingMode===11&&this.curinst_Parameters0===255){this.$5=255|this.curinst_Parameters1<<8;}else{this.$5=this.$15();}},DEC:function(){var $0=this.$16();$0--;this.setByte(this.$15(),$0);this.$18($0);},INC:function(){var $0=this.$16();$0++;this.setByte(this.$15(),$0);this.$18($0);},ADC:function(){var $0=this.$16();var $1=(this.$6&1);var $2=(this.$2+$0+$1);this.setFlag(1,$2>255);this.setFlag(64,((this.$2^$0)&128)!==128&&((this.$2^$2)&128)===128);this.$2=($2&255);this.$18(this.$2);},LSR:function(){var $0=this.$16();this.setFlag(1,($0&1)===1);$0=$0>>1&255;this.$18($0);if(this.curinst_AddressingMode===2){this.$2=$0;}else{this.setByte(this.$15(),$0);}},SBC:function(){var $0=this.$16();var $1=((this.$6^1)&1);var $2=(this.$2-$0-$1);this.setFlag(64,((this.$2^$2)&128)===128&&((this.$2^$0)&128)===128);this.setFlag(1,($2<256));this.$2=($2&255);this.$18(this.$2);},AND:function(){this.$2=(this.$2&this.$16());this.$18(this.$2);},ORA:function(){this.$2=(this.$2|this.$16());this.$18(this.$2);},EOR:function(){this.$2=(this.$2^this.$16());this.$18(this.get_accumulator());},ASL:function(){var $0=this.$16();this.setFlag(1,(($0&128)===128));$0=($0<<1)&254;if(this.curinst_AddressingMode===2){this.$2=$0;}else{this.setByte(this.$15(),$0);}this.$18($0);},BIT:function(){var $0=this.$16();this.setFlag(64,($0&64)===64);if(($0&128)===128){this.$6=this.$6|128;}else{this.$6=this.$6&127;}if(($0&this.get_accumulator())===0){this.$6=this.$6|2;}else{this.$6=this.$6&253;}},SEC:function(){this.setFlag(1,true);},CLC:function(){this.setFlag(1,false);},SEI:function(){this.setFlag(4,true);},CLI:function(){this.setFlag(4,false);},CLV:function(){this.setFlag(64,false);},$19:function($p0){this.setFlag(1,$p0>255);this.$18($p0&255);},CMP:function(){var $0=(this.get_accumulator()+256-this.$16());this.$19($0);},CPX:function(){var $0=(this.$3+256-this.$16());this.$19($0);},CPY:function(){var $0=(this.$4+256-this.$16());this.$19($0);},NOP:function(){if(this.curinst_AddressingMode===9){this.$15();}},$1A:function(){this.curinst_ExtraTiming=1;var $0=this.curinst_Parameters0&255;if(($0&128)===128){$0=$0-256;this.$5+=$0;}else{this.$5+=$0;}if((this.$5&255)<$0){this.curinst_ExtraTiming=2;}},BCC:function(){if((this.$6&1)!==1){this.$1A();}},BCS:function(){if((this.$6&1)===1){this.$1A();}},BPL:function(){if((this.$6&128)!==128){this.$1A();}},BMI:function(){if((this.$6&128)===128){this.$1A();}},BVC:function(){if((this.$6&64)!==64){this.$1A();}},BVS:function(){if((this.$6&64)===64){this.$1A();}},BNE:function(){if((this.$6&2)!==2){this.$1A();}},BEQ:function(){if((this.$6&2)===2){this.$1A();}},DEX:function(){this.$3=this.$3-1;this.$3=this.$3&255;this.$18(this.$3);},DEY:function(){this.$4=this.$4-1;this.$4=this.$4&255;this.$18(this.$4);},INX:function(){this.$3=this.$3+1;this.$3=this.$3&255;this.$18(this.$3);},INY:function(){this.$4=this.$4+1;this.$4=this.$4&255;this.$18(this.$4);},TAX:function(){this.$3=this.$2;this.$18(this.$3);},TXA:function(){this.$2=this.$3;this.$18(this.$2);},TAY:function(){this.$4=this.$2;this.$18(this.$4);},TYA:function(){this.$2=this.$4;this.$18(this.$2);},TXS:function(){this.$24=this.$3;},TSX:function(){this.$3=this.$24;this.$18(this.$3);},PHA:function(){this.pushStack(this.$2);},PLA:function(){this.$2=this.popStack();this.$18(this.$2);},PHP:function(){var $0=this.$6|16|32;this.pushStack($0);},PLP:function(){this.$6=this.popStack();},JSR:function(){this.pushStack((this.$5>>8)&255);this.pushStack((this.$5-1)&255);this.$5=this.$15();},ROR:function(){var $0=this.$16();var $1=0;if(this.getFlag(1)){$1=128;}this.setFlag(1,($0&1)===1);$0=($0>>1)|$1;this.$18($0);if(this.curinst_AddressingMode===2){this.$2=$0;}else{this.setByte(this.$15(),$0);}},ROL:function(){var $0=this.$16();var $1=0;if(this.getFlag(1)){$1=1;}this.setFlag(1,($0&128)===128);$0=$0<<1;$0=$0&255;$0=$0|$1;this.$18($0);if(this.curinst_AddressingMode===2){this.$2=$0;}else{this.setByte(this.$15(),$0);}},RTS:function(){var $0,$1;$1=(this.popStack()+1)&255;$0=this.popStack();this.$5=(($0<<8)|$1);},RTI:function(){this.$6=this.popStack();var $0=this.popStack();var $1=this.popStack();this.$5=((256*$1)+$0);},BRK:function(){this.$5=this.$5+1;this.pushStack(this.$5>>8&255);this.pushStack(this.$5&255);var $0=this.$6|16|32;this.pushStack($0);this.$6=this.$6|20;this.set_addressBus(65534);var $1=this.getCurrentByte();this.set_addressBus(65535);var $2=this.getCurrentByte();this.$5=$1+$2*256;},$1D:null,$1E:null,get_pixelWhizzler:function(){return this.$1E;},set_pixelWhizzler:function(value){this.$1E=value;this.$1E.set_nmiHandler(this.$20);return value;},$1F:null,get_soundBopper:function(){return this.$1F;},set_soundBopper:function(value){this.$1F=value;this.$1F.set_nmiHandler(this.$22);return value;},$20:null,$21:function(){this.$D=true;},$22:null,$23:function(){this.$E=(this.$1F.get_irqAsserted()|this.$1D.get_irqAsserted())===1;},get_cart:function(){return this.$1D;},set_cart:function(value){this.$1D=value;this.$1D.set_nmiHandler(this.$22);return value;},$24:255,get_stackPointer:function(){return this.$24;},pushStack:function(data){this.$1C[this.$24+256]=data;this.$24--;if(this.$24<0){this.$24=255;}},popStack:function(){this.$24++;if(this.$24>255){this.$24=0;}return this.$1C[this.$24+256]&255;},getCurrentByte:function(){this.set_dataBus(this.getByte(this.get_addressBus()));return this.get_dataBus();},getByte:function(address){var $0=0;switch(address&61440){case 0:case 4096:if(address<2048){$0=this.$1C[address];}else{$0=address>>8;}break;case 8192:case 12288:$0=this.$1E.getByte(this.$C,address);break;case 16384:switch(address){case 16406:break;case 16407:break;case 16405:break;default:$0=address>>8;break;}break;case 20480:$0=address>>8;break;case 24576:case 28672:case 32768:case 36864:case 40960:case 45056:case 49152:case 53248:case 57344:case 61440:$0=this.$1D.getByte(this.$C,address);break;default:throw new Error('Bullshit!');}return $0&255;},setCurrentByte:function(){this.setByte(this.get_addressBus(),this.get_dataBus()&255);},setByte:function(address,data){if(address<2048){this.$1C[address&2047]=data;return;}switch(address&61440){case 0:case 4096:this.$1C[address&2047]=data;break;case 20480:this.get_cart().setByte(this.$C,address,data);break;case 24576:case 28672:case 32768:case 36864:case 40960:case 45056:case 49152:case 53248:case 57344:case 61440:this.get_cart().setByte(this.$C,address,data);break;case 8192:case 12288:this.$1E.setByte(this.$C,address,data);break;case 16384:switch(address){case 16384:case 16385:case 16386:case 16387:case 16388:case 16389:case 16390:case 16391:case 16392:case 16393:case 16394:case 16395:case 16396:case 16397:case 16398:case 16399:case 16405:case 16407:break;case 16404:this.$1E.copySprites(this.$1C,data*256);this.curinst_ExtraTiming=this.curinst_ExtraTiming+512;break;case 16406:break;}break;}},findNextEvent:function(){this.$F=this.$C+this.$1E.get_nextEventAt();},$25:function(){this.$1E.handleEvent(this.get_clock());this.findNextEvent();},$27:false,get_debugging:function(){return this.$27;},set_debugging:function(value){this.$27=value;return value;},get_instructionUsage:function(){return this.$26;},$28:255,get_instructionHistoryPointer:function(){return this.$28;},get_instructionHistory:function(){return this.$29;},writeInstructionHistoryAndUsage:function(){this.$26[this.curinst_OpCode]++;},peekInstruction:function(address){var $0=new NES.CPU.Fastendo.Instruction();$0.opCode=this.getByte(address++);$0.addressingMode=this.addressmode[$0.opCode];$0.length=1;return $0;}}
NES.CPU.Fastendo.smallInstruction=function(){}
NES.CPU.Fastendo.smallInstruction.unpackInstruction=function(instruction){var $0=new NES.CPU.Fastendo.Instruction();$0.opCode=instruction&255;$0.parameters0=(instruction>>>8)&255;$0.parameters1=(instruction>>>16)&255;return $0;}
NES.CPU.Fastendo.Instruction=function(){}
NES.CPU.Fastendo.Instruction.prototype={addressingMode:0,address:0,opCode:0,parameters0:0,parameters1:0,extraTiming:0,length:0}
NES.CPU.Fastendo.CPUStatus=function(){}
NES.CPU.Fastendo.CPUStatus.prototype={statusRegister:0,programCounter:0,accumulator:0,indexRegisterX:0,indexRegisterY:0}
Type.registerNamespace('NES.CPU.nitenedo');NES.CPU.nitenedo.NESMachine=function(ppu,cart){this.$0=ppu;this.$0.set_frameFinishHandler(ss.Delegate.create(this,this.$6));this.$1=cart;cpuCart = this.$1;cpuPixelWhizzler = this.$0;this.$0.set_chrRomHandler(this.$1);this.initialize();}
NES.CPU.nitenedo.NESMachine.prototype={$0:null,$1:null,get_cart:function(){return this.$1;},add_soundStatusChanged:function(value){this.$2=ss.Delegate.combine(this.$2,value);},remove_soundStatusChanged:function(value){this.$2=ss.Delegate.remove(this.$2,value);},$2:null,$3:true,get_enableSound:function(){return this.$3;},set_enableSound:function(value){if(this.$3!==value){if(this.$2!=null){this.$2.invoke(this,ss.EventArgs.Empty);}this.$3=value;}return value;},setupSound:function(){},$4:false,$5:false,$6:function(){this.$7=false;},$7:false,initialize:function(){this.$8=0;this.$0.initialize();this.$1.initializeCart();resetCPU();powerOn();},reset:function(){if(this.$1!=null){this.$0.initialize();this.$1.initializeCart();resetCPU();powerOn();}},$8:0,get_frameCount:function(){return this.$8;},set_frameCount:function(value){this.$8=value;return value;},add_drawscreen:function(value){this.$9=ss.Delegate.combine(this.$9,value);},remove_drawscreen:function(value){this.$9=ss.Delegate.remove(this.$9,value);},$9:null,get_isRunning:function(){return true;},get_PPU:function(){return this.$0;}}
Type.registerNamespace('NES.CPU.PixelWhizzlerClasses');NES.CPU.PixelWhizzlerClasses.IPPU=function(){};NES.CPU.PixelWhizzlerClasses.IPPU.registerInterface('NES.CPU.PixelWhizzlerClasses.IPPU');Type.registerNamespace('NES.CPU.PPUClasses');NES.CPU.PPUClasses.NESSprite=function(){}
NES.CPU.PPUClasses.NESSprite.prototype={yPosition:0,xPosition:0,spriteNumber:0,foreground:false,isVisible:false,tileIndex:0,attributeByte:0,flipX:false,flipY:false,changed:false}
NES.CPU.PPUClasses.PixelWhizzler=function(){this.$13=new Array(256);this.$17=new Array(256);this.rgb32OutBuffer=new Array(256*256);this.outBuffer=new Array(256*256);this.$1B=new Array(256*256);this._palette=new Array(32);this.sprite0scanline=-1;this.sprite0x=-1;this.$2A=new Array(256);this.$2D=new Array(256*2);this.initSprites();this.$D=new Array(240*256);}
NES.CPU.PPUClasses.PixelWhizzler.prototype={currentXPosition:0,currentYPosition:0,get_currentYPosition:function(){return this.currentYPosition;},get_currentXPosition:function(){return this.currentXPosition;},$9:0,$A:0,get_scanlinePos:function(){return this.$A;},get_scanlineNum:function(){return this.$9;},$B:false,get_isDebugging:function(){return this.$B;},set_isDebugging:function(value){this.$B=value;return value;},initialize:function(){this._PPUAddress=0;this._PPUStatus=0;this._PPUControlByte0=0;this._PPUControlByte1=0;this._hScroll=0;this.$9=0;this.$A=0;this.$2B=0;},$C:false,get_shouldRender:function(){return this.$C;},set_shouldRender:function(value){this.$C=value;return value;},$D:null,$E:0,get_frames:function(){return this.$E;},vidRAM_GetNTByte:function(address){var $0=0;if(address>=8192&&address<12288){$0=this.chrRomHandler.getPPUByte(0,address);}else{$0=this.chrRomHandler.getPPUByte(0,address);}return $0;},hitSprite:false,$F:false,get_handleVBlankIRQ:function(){return this.$F;},set_handleVBlankIRQ:function(value){this.$F=value;return value;},_PPUControlByte0:0,_PPUControlByte1:0,get_ppuControlByte0:function(){return this._PPUControlByte0;},set_ppuControlByte0:function(value){if(this._PPUControlByte0!==value){this._PPUControlByte0=value;this.$10();}return value;},$10:function(){if((this._PPUControlByte0&16)===16){this._backgroundPatternTableIndex=4096;}else{this._backgroundPatternTableIndex=0;}},get_nmiIsThrown:function(){return (this._PPUControlByte0&128)===128;},get_ppuControlByte1:function(){return this._PPUControlByte1;},set_ppuControlByte1:function(value){this._PPUControlByte1=value;return value;},get_backgroundVisible:function(){return this._tilesAreVisible;},_spritesAreVisible:false,_tilesAreVisible:false,get_spritesAreVisible:function(){return this._spritesAreVisible;},_PPUStatus:0,get_ppuStatus:function(){return this._PPUStatus;},set_ppuStatus:function(value){this._PPUStatus=value;return value;},_PPUAddress:0,get_ppuAddress:function(){return this._PPUAddress;},set_ppuAddress:function(value){this._PPUAddress=value;return value;},$11:0,$12:true,_backgroundPatternTableIndex:0,get_patternTableIndex:function(){return this._backgroundPatternTableIndex;},$14:true,get_needToDraw:function(){return this.$14;},$15:true,get_isRendering:function(){return this.$15;},frameClock:0,frameEnded:false,$16:false,get_frameOn:function(){return this.$16;},set_frameOn:function(value){this.$16=value;return value;},$18:0,get_nameTableMemoryStart:function(){return this.$18;},set_nameTableMemoryStart:function(value){this.$18=value;return value;},get_currentFrame:function(){return this.$D;},renderScanline:function(scanlineNum){throw new Error('Not Implemented');},lastcpuClock:0,get_lastcpuClock:function(){return this.lastcpuClock;},set_lastcpuClock:function(value){this.lastcpuClock=value;return value;},drawTo:function(cpuClockNum){var $0=(cpuClockNum-this.lastcpuClock)*3;if(this.frameClock<6820){if(this.frameClock+$0<6820){this.frameClock+=$0;$0=0;}else{$0+=this.frameClock-6820;this.frameClock=6820;}}this.bumpScanline($0);this.lastcpuClock=cpuClockNum;},bumpScanline:function(frClock){do{switch(this.frameClock++){case 0:break;case 6820:this.clearVINT();this.$16=true;frameOn = true;if(this.spriteChanges){this.unpackSprites();this.spriteChanges=false;}break;case 7125:break;case 7161:this.vbufLocation=0;this.xNTXor=0;this.yNTXor=0;this.currentXPosition=0;this.currentYPosition=0;break;case 89342:this.$C=true;frameOn = false;this.setupVINT();this.$16=false;this.frameClock=0;break;}if(this.frameClock>=7161&&this.frameClock<=89342){if(this.currentXPosition<256&&this.vbufLocation<61440){this.xPosition=this.currentXPosition+this.lockedHScroll;if((this.xPosition&7)===0){this.xNTXor=((this.xPosition&256)===256)?1024:0;this.xPosition&=255;this.$34();}var $0=(this._tilesAreVisible)?this.getNameTablePixel():0;var $1=(this._spritesAreVisible)?this.getSpritePixel():0;if(!this.hitSprite&&this.spriteZeroHit&&$0!==0){this.hitSprite=true;this._PPUStatus=this._PPUStatus|64;}var $2=(this.spriteIsForegroundPixel||($0===0&&$1!==0))?$1:$0;var $3=this._palette[$2];writePixel(this.vbufLocation, $3);;this.vbufLocation++;}this.currentXPosition++;if(this.currentXPosition>340){this.currentXPosition=0;this.currentYPosition++;this.preloadSprites(this.currentYPosition);if(this.$2C>=7){this._PPUStatus=this._PPUStatus|32;}this.lockedHScroll=this._hScroll;this.updatePixelInfo();this.runNewScanlineEvents();}}}while(frClock-->0);},get_outBuffer:function(){return this.outBuffer;},get_videoBuffer:function(){return this.rgb32OutBuffer;},setVideoBuffer:function(inBuffer){this.rgb32OutBuffer=inBuffer;},$19:false,checkVBlank:function(){if(!this.$24&&!this.$16&&this.get_nmiIsThrown()&&this.get_$23()){this.$21.invoke();this.set_handleVBlankIRQ(true);this.$24=true;}},vbufLocation:0,pixelWidth:32,get_pixelWidth:function(){return this.pixelWidth;},set_pixelWidth:function(value){this.pixelWidth=value;return value;},$1A:false,get_fillRGB:function(){return this.$1A;},set_fillRGB:function(value){this.$1A=value;return value;},updatePixelInfo:function(){this.$18=this.nameTableBits*1024;},$1C:false,$1D:false,$1E:function(){return this.$1C;},$1F:function(){return this.$1D;},nameTableBits:0,$20:true,get_palette:function(){return this._palette;},set_palette:function(value){this._palette=value;return value;},setByte:function(Clock,address,data){this.$14=true;switch(address&7){case 0:this.drawTo(Clock);this._PPUControlByte0=data;this.nameTableBits=this._PPUControlByte0&3;this._backgroundPatternTableIndex=((this._PPUControlByte0&16)>>4)*4096;this.updatePixelInfo();break;case 1:this.drawTo(Clock);this.$15=(data&24)!==0;this._PPUControlByte1=data;this._spritesAreVisible=(this._PPUControlByte1&16)===16;this._tilesAreVisible=(this._PPUControlByte1&8)===8;this.$1C=(this._PPUControlByte1&2)!==2;this.$1D=(this._PPUControlByte1&4)!==4;this.updatePixelInfo();break;case 2:this.$11=data;break;case 3:this.$2B=data&255;break;case 4:this.$2A[this.$2B]=data;this.$2B=(this.$2B+1)&255;this.$29[this.$2B/4].changed=true;this.spriteChanges=true;break;case 5:if(this.$12){this.drawTo(Clock);this._hScroll=data;this.lockedHScroll=this._hScroll&7;this.updatePixelInfo();this.$12=false;}else{this.drawTo(Clock);this._vScroll=data;if(data>240){this._vScroll=data-256;}if(!this.$16||(this.$16&&!this.$15)){this.lockedVScroll=this._vScroll;}this.$12=true;this.updatePixelInfo();}break;case 6:if(this.$12){this._PPUAddress=(this._PPUAddress&255)|((data&63)<<8);this.$12=false;}else{this._PPUAddress=(this._PPUAddress&32512)|data&255;this.$12=true;this.drawTo(Clock);this._hScroll=((this._PPUAddress&31)<<3);this._vScroll=(((this._PPUAddress>>5)&31)<<3);this._vScroll|=((this._PPUAddress>>12)&3);this.nameTableBits=((this._PPUAddress>>10)&3);if(this.$16){this.lockedHScroll=this._hScroll;this.lockedVScroll=this._vScroll;this.lockedVScroll-=this.currentYPosition;}this.updatePixelInfo();}break;case 7:if((this._PPUAddress&65280)===16128){this.drawTo(Clock);this.writeToNESPalette(this._PPUAddress,data);this.updatePixelInfo();}else{if((this._PPUAddress&61440)===8192){this.chrRomHandler.setPPUByte(Clock,this._PPUAddress,data);}else{if(this.$20){this.chrRomHandler.setPPUByte(Clock,this._PPUAddress,data);}}}if((this.get_ppuControlByte0()&4)===4){this._PPUAddress=(this._PPUAddress+32);}else{this._PPUAddress=(this._PPUAddress+1);}this.$12=true;this.set_ppuAddress((this.get_ppuAddress()&16383));break;}},getByte:function(Clock,address){switch(address&7){case 0:case 1:case 5:case 6:return this.$11;case 2:var $0;this.$12=true;$0=(this.$11&31)|this._PPUStatus;this.drawTo(Clock);if(($0&128)===128){this._PPUStatus=this._PPUStatus&~128;}this.updatePixelInfo();return $0;case 4:var $1=this.$2A[this.$2B];return $1;case 7:if((this.get_ppuAddress()&65280)===16128){$1=this._palette[this.get_ppuAddress()&31];this.$11=this.chrRomHandler.getPPUByte(Clock,this._PPUAddress-4096);}else{$1=this.$11;if((this._PPUAddress>=8192&this._PPUAddress<=12287)===1){this.$11=this.chrRomHandler.getPPUByte(Clock,this._PPUAddress);}else{this.$11=this.chrRomHandler.getPPUByte(Clock,this._PPUAddress&16383);}}if((this._PPUControlByte0&4)===4){this._PPUAddress=this._PPUAddress+32;}else{this._PPUAddress=this._PPUAddress+1;}this._PPUAddress=(this._PPUAddress&16383);return $1;}return 0;},$21:null,get_nmiHandler:function(){return this.$21;},set_nmiHandler:function(value){this.$21=value;return value;},get_irqAsserted:function(){return false;},set_irqAsserted:function(value){return value;},get_nextEventAt:function(){if(this.frameClock<6820){return (6820-this.frameClock)/3;}else{return (((89345-this.frameClock)/341)/3);}},handleEvent:function(Clock){this.drawTo(Clock);},resetClock:function(Clock){this.lastcpuClock=Clock;},$22:null,get_frameFinishHandler:function(){return this.$22;},set_frameFinishHandler:function(value){this.$22=value;return value;},get_$23:function(){return (this._PPUStatus&128)===128;},$24:false,setupVINT:function(){this._PPUStatus=this._PPUStatus|128;this.$24=false;this.$E=this.$E+1;this.$14=false;if(this.get_nmiIsThrown()){cpuHandleNMI = true;this.set_handleVBlankIRQ(true);this.$24=true;}},clearVINT:function(){this._PPUStatus=0;this.hitSprite=false;this.spriteSize=((this._PPUControlByte0&32)===32)?16:8;if((this._PPUControlByte1&24)!==0){this.$15=true;}},$25:function(){},runNewScanlineEvents:function(){this.yPosition=this.currentYPosition+this.lockedVScroll;if(this.yPosition<0){this.yPosition+=240;}if(this.yPosition>=240){this.yPosition-=240;this.yNTXor=2048;}else{this.yNTXor=0;}},$26:function(){},$27:function(){},_hScroll:0,_vScroll:0,lockedHScroll:0,lockedVScroll:0,get_hScroll:function(){return this.lockedHScroll;},get_vScroll:function(){return this.lockedVScroll;},spriteChanges:false,$28:false,get_spriteCopyHasHappened:function(){return this.$28;},set_spriteCopyHasHappened:function(value){this.$28=value;return value;},spriteZeroHit:false,spriteIsForegroundPixel:false,currentSprites:null,$29:null,_maxSpritesPerScanline:64,get_maxSpritesPerScanline:function(){return this._maxSpritesPerScanline;},set_maxSpritesPerScanline:function(value){this._maxSpritesPerScanline=value;return value;},$2B:0,get_spriteRam:function(){return this.$2A;},copySprites:function(source,copyFrom){for(var $0=0;$0<256;++$0){var $1=(this.$2B+$0)&255;if(this.$2A[$1]!==source[copyFrom+$0]){this.$2A[$1]=source[copyFrom+$0];var $2=$1>>2;this.$29[$2].changed=true;}}this.$28=true;this.spriteChanges=true;},initSprites:function(){this.currentSprites=new Array(this._maxSpritesPerScanline);for(var $0=0;$0<this._maxSpritesPerScanline;++$0){this.currentSprites[$0]=new NES.CPU.PPUClasses.NESSprite();}this.$29=new Array(64);for(var $1=0;$1<64;++$1){this.$29[$1]=new NES.CPU.PPUClasses.NESSprite();}},getSpritePixel:function(){this.spriteIsForegroundPixel=false;this.spriteZeroHit=false;var $0=0;var $1=0;var $2=0;var $3=0;for(var $4=0;$4<this.$2C;++$4){var $5=this.currentSprites[$4];if($5.xPosition>0&&this.currentXPosition>=$5.xPosition&&this.currentXPosition<$5.xPosition+8){var $6=0;if((this._PPUControlByte0&8)===8){$6=4096;}$2=this.currentXPosition-$5.xPosition;$1=this.currentYPosition-$5.yPosition-1;$1=$1&(this.spriteSize-1);$3=$5.tileIndex;if((this._PPUControlByte0&32)===32){if(($3&1)===1){$6=4096;$3=$3^1;}else{$6=0;}}$0=this.whissaSpritePixel($6,$2,$1,$5,$3);if($0!==0){if($5.spriteNumber===0){this.spriteZeroHit=true;}this.spriteIsForegroundPixel=$5.foreground;return ($0|$5.attributeByte);}}}return 0;},whissaSpritePixel:function(patternTableIndex,x,y,sprite,tileIndex){var $0;var $1;if(sprite.flipY){y=this.spriteSize-y-1;}if(y>=8){y+=8;}$0=this.chrRomHandler.getPPUByte(0,patternTableIndex+tileIndex*16+y);$1=this.chrRomHandler.getPPUByte(0,patternTableIndex+tileIndex*16+y+8);return ((sprite.flipX)?(($0>>x)&1)|((($1>>x)<<1)&2):(($0>>7-x)&1)|((($1>>7-x)<<1)&2));},$2C:0,spriteSize:0,get_spritesOnLine:function(){return this.$2D;},preloadSprites:function(scanline){this.$2C=0;this.sprite0scanline=-1;var $0=this.currentYPosition-1;for(var $1=0;$1<256;$1+=4){var $2=(($1+this.$2B)&255)>>2;var $3=this.$29[$2].yPosition+1;if(scanline>=$3&&scanline<$3+this.spriteSize){if($2===0){this.sprite0scanline=scanline;this.sprite0x=this.$29[$2].xPosition;}var $4=$1>>2;this.currentSprites[this.$2C]=this.$29[$2];this.currentSprites[this.$2C].isVisible=true;this.$2C++;if(this.$2C===this._maxSpritesPerScanline){break;}}}if(this.$2C>7){this._PPUStatus=this._PPUStatus|32;}},unpackSprites:function(){for(var $0=0;$0<this.$29.length;++$0){if(this.$29[$0].changed){this.$2E($0);}}},$2E:function($p0){var $0=this.$2A[$p0*4+2];this.$29[$p0].isVisible=true;this.$29[$p0].attributeByte=(($0&3)<<2)|16;this.$29[$p0].yPosition=this.$2A[$p0*4];this.$29[$p0].xPosition=this.$2A[$p0*4+3];this.$29[$p0].spriteNumber=$p0;this.$29[$p0].foreground=($0&32)!==32;this.$29[$p0].flipX=($0&64)===64;this.$29[$p0].flipY=($0&128)===128;this.$29[$p0].tileIndex=this.$2A[$p0*4+1];this.$29[$p0].changed=false;},$2F:0,$30:0,$31:0,$32:0,xNTXor:0,yNTXor:0,$33:true,xPosition:0,yPosition:0,getNameTablePixel:function(){var $0=((this.$2F&128)>>7)+((this.$30&128)>>6);this.$2F=this.$2F<<1;this.$30=this.$30<<1;if($0>0){$0+=this.$31;}return $0;},$34:function(){var $0=this.$18^this.xNTXor^this.yNTXor;var $1=this.xPosition>>3;var $2=((this.yPosition>>3)%30)<<5;var $3=8192+$0+$1+$2;var $4=this.chrRomHandler.getPPUByte(0,$3);var $5=this.yPosition&7;var $6=this._backgroundPatternTableIndex+($4*16)+$5;this.$2F=this.chrRomHandler.getPPUByte(0,$6);this.$30=this.chrRomHandler.getPPUByte(0,$6+8);this.$31=this.$35($0,$1,this.yPosition>>3);},$35:function($p0,$p1,$p2){var $0=this.chrRomHandler.getPPUByte(0,8192+$p0+960+($p1>>2)+(($p2>>2)<<3));switch(($p1&2)|(($p2&2)*2)){case 0:return ($0<<2)&12;case 2:return $0&12;case 4:return ($0>>2)&12;case 6:return ($0>>4)&12;}return 0;},chrRomHandler:null,get_chrRomHandler:function(){return this.chrRomHandler;},set_chrRomHandler:function(value){this.chrRomHandler=value;return value;},writeToNESPalette:function(address,data){var $0=address&31;this._palette[$0]=data;if((this._PPUAddress&65519)===16128){this._palette[($0^16)&31]=data;}},getFrameChecksum:function(){var $0=0;var $enum1=ss.IEnumerator.getEnumerator(this.rgb32OutBuffer);while($enum1.moveNext()){var $1=$enum1.get_current();$0+=$1;$0&=268435455;}return $0;}}
NES.CPU.PPUClasses.PPUWriteEvent=function(){}
NES.CPU.PPUClasses.PPUWriteEvent.prototype={$0:false,get_isWrite:function(){return this.$0;},set_isWrite:function(value){this.$0=value;return value;},$1:0,get_scanlineNum:function(){return this.$1;},set_scanlineNum:function(value){this.$1=value;return value;},$2:0,get_scanlinePos:function(){return this.$2;},set_scanlinePos:function(value){this.$2=value;return value;},$3:0,get_frameClock:function(){return this.$3;},set_frameClock:function(value){this.$3=value;return value;},$4:0,get_registerAffected:function(){return this.$4;},set_registerAffected:function(value){this.$4=value;return value;},$5:0,get_dataWritten:function(){return this.$5;},set_dataWritten:function(value){this.$5=value;return value;},get_text:function(){return this.toString();},toString:function(){return String.format(' {0:x2} written to {1:x4} at {2}, {3}',this.$4,this.$5,this.$1,this.$2);}}
Type.registerNamespace('bulbascript');bulbascript.bulbascriptApp=function(){}
bulbascript.bulbascriptApp.main=function(args){}
bulbascript.bulbascriptApp.$0=function($p0,$p1){drawFrame();}
bulbascript.bulbascriptApp.loadRom=function(data){var $0=new NES.CPU.PPUClasses.PixelWhizzler();var $1=new NES.CPU.Machine.ROMLoader.ByteArrayHolder();$1.set_data(data);var $2=NES.CPU.Machine.ROMLoader.iNESFileHandler.loadROM($0,$1);bulbascript.bulbascriptApp.nes=new NES.CPU.nitenedo.NESMachine($0,$2);bulbascript.bulbascriptApp.nes.add_drawscreen(bulbascript.bulbascriptApp.$0);}
bulbascript.bulbascriptApp.getVidData=function(){return bulbascript.bulbascriptApp.nes.get_PPU().get_videoBuffer();}
bulbascript.bulbascriptApp.getFrameChecksum=function(){return bulbascript.bulbascriptApp.nes.get_PPU().getFrameChecksum();}
NES.CPU.Machine.Carts.BaseCart.registerClass('NES.CPU.Machine.Carts.BaseCart',null,NES.CPU.Machine.Carts.INESCart);NES.CPU.Machine.ROMLoader.ByteArrayHolder.registerClass('NES.CPU.Machine.ROMLoader.ByteArrayHolder');NES.CPU.Machine.ROMLoader.iNESFileHandler.registerClass('NES.CPU.Machine.ROMLoader.iNESFileHandler');NES.CPU.NESCart.registerClass('NES.CPU.NESCart',NES.CPU.Machine.Carts.BaseCart);NES.CPU.Fastendo.CPU2A03.registerClass('NES.CPU.Fastendo.CPU2A03');NES.CPU.Fastendo.smallInstruction.registerClass('NES.CPU.Fastendo.smallInstruction');NES.CPU.Fastendo.Instruction.registerClass('NES.CPU.Fastendo.Instruction');NES.CPU.Fastendo.CPUStatus.registerClass('NES.CPU.Fastendo.CPUStatus');NES.CPU.nitenedo.NESMachine.registerClass('NES.CPU.nitenedo.NESMachine');NES.CPU.PPUClasses.NESSprite.registerClass('NES.CPU.PPUClasses.NESSprite');NES.CPU.PPUClasses.PixelWhizzler.registerClass('NES.CPU.PPUClasses.PixelWhizzler',null,NES.CPU.PixelWhizzlerClasses.IPPU,NES.CPU.PixelWhizzlerClasses.IPPU);NES.CPU.PPUClasses.PPUWriteEvent.registerClass('NES.CPU.PPUClasses.PPUWriteEvent');bulbascript.bulbascriptApp.registerClass('bulbascript.bulbascriptApp');NES.CPU.Fastendo.CPU2A03.$1B=[7,6,0,0,3,2,5,0,3,2,2,0,6,4,6,0,2,5,0,0,3,3,6,0,2,4,2,0,6,4,7,0,6,6,0,0,3,2,5,0,3,2,2,0,4,4,6,0,2,5,0,0,3,3,6,0,2,4,2,0,6,4,7,0,6,6,0,0,3,2,5,0,3,2,2,0,3,4,6,0,2,5,0,0,0,3,6,0,2,4,2,0,6,4,6,0,6,6,0,0,3,3,5,0,3,2,2,0,5,4,6,0,2,5,0,0,0,4,6,0,2,4,2,0,6,4,7,0,3,6,3,0,3,3,3,0,2,3,2,0,4,4,4,0,2,6,0,0,4,4,4,0,2,5,2,0,0,5,0,0,2,6,2,0,3,3,3,0,2,2,2,0,4,4,4,0,2,5,0,0,4,4,4,0,2,4,2,0,4,4,4,0,2,6,3,0,3,2,5,0,2,2,2,0,4,4,6,0,2,5,0,0,3,4,6,0,2,4,2,0,6,4,7,0,2,6,3,0,3,3,5,0,2,2,2,0,4,4,6,0,2,5,0,0,3,4,6,0,2,4,2,0,6,4,7,0];NES.CPU.PPUClasses.PixelWhizzler.pal=new Array(256*4);NES.CPU.PPUClasses.PixelWhizzler.frameClockEnd=89342;bulbascript.bulbascriptApp.nes=null;
// ---- Do not remove this footer ----
// This script was generated using Script# v0.6.0.0 (http://projects.nikhilk.net/ScriptSharp)
// -----------------------------------
}
ss.loader.registerScript('bulbascript',[],executeScript);})();